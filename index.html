<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>The Effect of International Shipping on Ocean Nitrate Levels</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta name="citation_title" content="The Effect of International Shipping on Ocean Nitrate Levels">
<meta name="citation_author" content="Nathan Butler">
<meta name="citation_author" content="Jeffrey Smith">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=Particle emissions from ships: Dependence on fuel type;,citation_author=Hulda Winnes;,citation_author=Erik Fridell;,citation_publication_date=2009;,citation_cover_date=2009;,citation_year=2009;,citation_fulltext_html_url=https://doi.org/10.3155/1047-3289.59.12.1391;,citation_issue=12;,citation_doi=10.3155/1047-3289.59.12.1391;,citation_volume=59;,citation_journal_title=Journal of the Air &amp;amp;amp; Waste Management Association;,citation_publisher=Taylor &amp;amp; Francis;">
<meta name="citation_reference" content="citation_title=Mitigation of ship emissions: Overview of recent trends;,citation_author=Ali-Akbar Sarbanha;,citation_author=Faı̈çal Larachi;,citation_author=Seyed-Mohammad Taghavi;,citation_author=Mareen Thiboutot-Rioux;,citation_author=Alexandre Boudreau;,citation_author=Gabriel Dugas;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://doi.org/10.1021/acs.iecr.2c03621;,citation_issue=4;,citation_doi=10.1021/acs.iecr.2c03621;,citation_volume=62;,citation_journal_title=Industrial &amp;amp;amp; Engineering Chemistry Research;">
<meta name="citation_reference" content="citation_title=The impact of alternative fuels on ship engine emissions and aftertreatment systems: A review;,citation_abstract=Marine engines often use diesel as an alternative fuel to improve the economy. In recent years, waste oil, biodiesel and alcohol fuel are the most famous research directions among the alternative fuels for diesel. With the rapid development of the shipping industry, the air of coastal areas is becoming increasingly polluted. It is now necessary to reduce the emission of marine engines to meet the strict emission regulations. There are many types of alternative fuels for diesel oil and the difference of the fuel may interfere with the engine emissions; however, PM, HC, CO and other emissions will have a negative impact on SCR catalyst. This paper reviews the alternative fuels such as alcohols, waste oils, biodiesel made from vegetable oil and animal oil, and then summarizes and analyzes the influence of different alternative fuels on engine emissions and pollutant formation mechanism. In addition, this paper also summarizes the methods that can effectively reduce the emissions of marine engines; it can provide a reference for the study of diesel alternative fuel and the reduction of marine engine emissions.;,citation_author=Shuo Feng;,citation_author=Shirui Xu;,citation_author=Peng Yuan;,citation_author=Yuye Xing;,citation_author=Boxiong Shen;,citation_author=Zhaoming Li;,citation_author=Chenguang Zhang;,citation_author=Xiaoqi Wang;,citation_author=Zhuozhi Wang;,citation_author=Jiao Ma;,citation_author=Wenwen Kong;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://www.mdpi.com/2073-4344/12/2/138;,citation_issue=2;,citation_doi=10.3390/catal12020138;,citation_issn=2073-4344;,citation_volume=12;,citation_journal_title=Catalysts;">
<meta name="citation_reference" content="citation_title=Transition to near-zero emission shipping fleet powered by alternative fuels under uncertainty;,citation_abstract=Achieving a transition to a near-zero emission shipping requires deploying ships which are powered by low- or zero-carbon alternative fuels. This study delivers a transition plan for the fleet, including the selection of fuel type (among diesel, bio-LNG, bio-methanol and ng-ammonia) for each ship, and determining the number and sizes of ships to add or remove from the fleet in each time period through ship purchasing, chartering and retrofitting, so as to operate the resulting fleet at minimum net cost considering emissions, investment and operating costs and revenues under uncertainty. Results indicate that a single fuel cannot dominate the future. The transition from diesel to bio-methanol is favourable when life-cycle (well-to-wake) emissions are considered, whereas transition from diesel to ng-ammonia dominates when tank-to-wake emissions are considered. In the scenarios where emission costs are high, total emissions are reduced primarily thanks to chartering and retrofitting depending on the ship size.;,citation_author=Yadong Wang;,citation_author=undefined Iris;,citation_publication_date=2025;,citation_cover_date=2025;,citation_year=2025;,citation_fulltext_html_url=https://www.sciencedirect.com/science/article/pii/S1361920925000999;,citation_doi=https://doi.org/10.1016/j.trd.2025.104689;,citation_issn=1361-9209;,citation_volume=142;,citation_journal_title=Transportation Research Part D: Transport and Environment;">
<meta name="citation_reference" content="citation_title=Review of maritime transport;,citation_author=P. E. A. Stalker;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_doi=10.18356/9789210000970;,citation_publisher=United Nations Conference on Trade; Development;">
<meta name="citation_reference" content="citation_title=4th IMO GHG study;,citation_author=Shinichi Jasper;,citation_author=S Zhang;,citation_author=P. Pereda;,citation_author=B. Comer;,citation_author=E. Hauerhof;,citation_author=W. Schim van der Loeff;,citation_author=T. Smith;,citation_author=Y. Zhang;,citation_author=H. Kosaka;,citation_author=M. Adachi;,citation_author=J.-M. Bonello;,citation_author=C. Galbraith;,citation_author=Z. Gong;,citation_author=K. Hirata;,citation_author=D. Hummels;,citation_author=A. Kleijn;,citation_author=D. S. Lee;,citation_author=Y. Liu;,citation_author=A. Lucchesi;,citation_author=X. Mao;,citation_author=E. Muraoka;,citation_author=L. Osipova;,citation_author=H. Qian;,citation_author=D. Rutherford;,citation_author=S. Suárez de la Fuente;,citation_author=H. Yuan;,citation_author=C. Velandia Perico;,citation_author=Libo Wu;,citation_author=D. Sun;,citation_author=D.-H. Yoo;,citation_author=H. Xing;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_publisher=International Maritime Organization;">
<meta name="citation_reference" content="citation_title=Transport impacts on atmosphere and climate: shipping;,citation_abstract=Emissions of exhaust gases and particles from oceangoing ships are a significant and growing contributor to the total emissions from the transportation sector. We present an assessment of the contribution of gaseous and particulate emissions from oceangoing shipping to anthropogenic emissions and air quality. We also assess the degradation in human health and climate change created by these emissions. Regulating ship emissions requires comprehensive knowledge of current fuel consumption and emissions, understanding of their impact on atmospheric composition and climate, and projections of potential future evolutions and mitigation options. Nearly 70;,citation_author=Veronika Eyring;,citation_author=Ivar S. A. Isaksen;,citation_author=Terje Berntsen;,citation_author=William J. Collins;,citation_author=James J. Corbett;,citation_author=Oyvind Endresen;,citation_author=Roy G. Grainger;,citation_author=Jana Moldanova;,citation_author=Hans Schlager;,citation_author=David S. Stevenson;,citation_publication_date=2010;,citation_cover_date=2010;,citation_year=2010;,citation_fulltext_html_url=https://www.sciencedirect.com/science/article/pii/S1352231009003379;,citation_issue=37;,citation_doi=https://doi.org/10.1016/j.atmosenv.2009.04.059;,citation_issn=1352-2310;,citation_volume=44;,citation_journal_title=Atmospheric Environment;">
<meta name="citation_reference" content="citation_title=Ammonium, nitrate and phytoplankton interactions in a freshwater tidal estuarine zone: Potential effects of cultural eutrophication;,citation_abstract=Nitrate and ammonium are the most important nitrogen sources for phytoplankton growth. Differential utilization of inorganic nitrogenous compounds by phytoplankton has been observed and may have significant impacts on primary productivity at local scales. We used enrichment experiments with natural phytoplankton populations from the freshwater tidal zone of the Guadiana estuary, a coastal ecosystem increasingly subjected to anthropogenic influences, to study the effects of nitrate and ammonium on N-consumption and phytoplankton growth. In addition, we used combined additions of nitrate and ammonium to understand the inhibitory effect of ammonium over nitrate uptake. Ammonium concentrations in the freshwater tidal reaches of the Guadiana estuary throughout the sampling period were too low to exert an inhibitory effect on nitrate uptake or a toxic effect on phytoplankton growth. Nitrate was clearly the main nitrogen source for phytoplankton at the study site. Overall, nitrate seemed to become limiting at concentrations lower than 20 μM and N-limitation was particularly significant during summer. A trend of decreasing nitrate uptake with increasing ammonium concentrations and uptake suggested an overall preference for ammonium. However, preference for ammonium was group-specific, and it was observed mainly in green algae and cyanobacteria. In fact, cyanobacteria relied only on ammonium as their N-source. On the contrary, diatoms preferred nitrate, and did not respond to ammonium additions. The increasing eutrophication in the Guadiana estuary and particularly increased inputs of nitrogen as ammonium due to urban waste effluents may result in a shift in phytoplankton community composition, towards a dominance of cyanobacteria and green algae.;,citation_author=Rita B. Domingues;,citation_author=Ana B. Barbosa;,citation_author=Ulrich Sommer;,citation_author=Helena M. Galvão;,citation_publication_date=2011;,citation_cover_date=2011;,citation_year=2011;,citation_fulltext_html_url=https://doi.org/10.1007/s00027-011-0180-0;,citation_issue=3;,citation_doi=10.1007/s00027-011-0180-0;,citation_isbn=1420-9055;,citation_volume=73;,citation_journal_title=Aquatic Sciences;">
<meta name="citation_reference" content="citation_title=Inorganic nitrogen uptake by marine picoplankton: Evidence for size partitioning;,citation_abstract=A series of size-fractionation experiments was carried out in coastal waters around Georges Bank and in the oligotrophic NW Atlantic to assess the relative importance of picoplankton (&amp;amp;amp;lt; 1 µm) to community nitrogen utilization and to determine if there is a partitioning of the form of nitrogen used (NO3− or NH4+) based on organism size. Results indicate that picoplankton nitrogen uptake was substantial in coastal and oceanic waters, averaging &amp;gt;30% of the combined nitrate and ammonium uptake by the intact communities; the picoplankton portion of total community N uptake increased offshore. Of the summed nitrate and ammonium used across all sizes, ammonium was favored disproportionately by the picoplankton fraction. On average, however, the differences in preference for nitrogen form were relatively small. The size partitioning of photosynthetic activity and nitrogen uptake was similar.;,citation_author=W. G. Harrison;,citation_author=Laura J. E. Wood;,citation_publication_date=1988;,citation_cover_date=1988;,citation_year=1988;,citation_fulltext_html_url=https://aslopubs.onlinelibrary.wiley.com/doi/abs/10.4319/lo.1988.33.3.0468;,citation_issue=3;,citation_doi=https://doi.org/10.4319/lo.1988.33.3.0468;,citation_volume=33;,citation_journal_title=Limnology and Oceanography;">
<meta name="citation_reference" content="citation_title=Assessing the source of nitrate pollution in water using stable n and o isotopes;,citation_author=Barbara Deutsch;,citation_author=Petra Kahle;,citation_author=Maren Voss;,citation_publication_date=2006;,citation_cover_date=2006;,citation_year=2006;,citation_issue=4;,citation_volume=26;,citation_journal_title=Agronomy for Sustainable Development;">
<meta name="citation_reference" content="citation_title=Identifying the major sources of nutrient water pollution;,citation_author=Larry J Puckett;,citation_publication_date=1995;,citation_cover_date=1995;,citation_year=1995;,citation_issue=9;,citation_volume=29;,citation_journal_title=Environmental Science &amp;amp;amp; Technology;,citation_publisher=ACS Publications;">
<meta name="citation_reference" content="citation_title=Tracing nitrate pollution sources and transformation in surface-and ground-waters using environmental isotopes;,citation_author=Yan Zhang;,citation_author=Fadong Li;,citation_author=Qiuying Zhang;,citation_author=Jing Li;,citation_author=Qiang Liu;,citation_publication_date=2014;,citation_cover_date=2014;,citation_year=2014;,citation_volume=490;,citation_journal_title=Science of the total environment;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Exploring new technologies for plankton observations and monitoring of ocean health;,citation_author=Pascal I. Hablützel;,citation_author=Isabelle Rombouts;,citation_author=Nick Dillen;,citation_author=Rune Lagaisse;,citation_author=Jonas Mortelmans;,citation_author=Anouk Ollevier;,citation_author=Michiel Perneel;,citation_author=Klaas Deneudt;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://www.jstor.org/stable/27217329;,citation_issue=4;,citation_issn=10428275, 2377617X;,citation_volume=34;,citation_journal_title=Oceanography;,citation_publisher=Oceanography Society;">
<meta name="citation_reference" content="citation_title=Plankton;,citation_abstract=Plankton comprises unicellular plants ? phytoplankton ? and generally small (millimetres or less) animals ? zooplankton ? that are adrift on the currents. Phytoplankton are responsible for about 45% of global annual primary production and are grazed by zooplankton, which in turn are suitably sized food items for predators including commercially important fish and great whales. Plankton are vital components of marine and freshwater water-column ecosystems. They also make major contributions to global biogeochemical cycling, and ameliorate atmospheric accumulation of carbon dioxide by ?pumping? carbon to the deep sea. The integrity of these roles is under threat from climate-related physiological impacts on individual organisms and on the wide-scale distribution of plankton communities.;,citation_author=Andrew S. Brierley;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_fulltext_html_url=https://doi.org/10.1016/j.cub.2017.02.045;,citation_issue=11;,citation_doi=10.1016/j.cub.2017.02.045;,citation_isbn=0960-9822;,citation_volume=27;,citation_journal_title=Current Biology;,citation_publisher=Elsevier;">
</head>

<body>

<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">The Effect of International Shipping on Ocean Nitrate Levels</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
        
        <div class="quarto-title-meta">

                <div>
            <div class="quarto-title-meta-heading">Authors</div>
            <div class="quarto-title-meta-contents">
                        <p>Nathan Butler </p>
                        <p>Jeffrey Smith </p>
                      </div>
          </div>
                
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>



    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#clustering" id="toc-clustering" class="nav-link" data-scroll-target="#clustering">Clustering</a></li>
  <li><a href="#chi-square" id="toc-chi-square" class="nav-link" data-scroll-target="#chi-square">Chi Square</a></li>
  <li><a href="#anova" id="toc-anova" class="nav-link" data-scroll-target="#anova">ANOVA</a></li>
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression">Linear Regression</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">



  


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This study examines how major shipping lanes affect the level of nitrate in the water and the effect this has on the phytoplankton levels in the surrounding area. We used data joined by longitude and latitude between the World Ocean Database and shipping density information from the World Bank Group to analyze the relationship between nitrate released from ships and the levels of phytoplankton in the surrounding ocean. We use statistical methods to show whether areas with higher shipping density are significantly different from areas with lower shipping density. In doing this we found a correlation between the shipping density and increased nitrate, and chlorophyll which often correlate to an increase in the phytoplankton in the area. These findings suggest that international shipping may be altering ocean chemistry in ways that impact primary producers, highlighting the need for greater attention to the ecological effects of global trade routes.</p>
</section>
<section id="background" class="level1">
<h1>Background</h1>
<p>According to the United Nations Conference on Trade and Development (UNCTAD), around 80% of international trade in goods by volume is done by the sea. This global cooperation is without cost, as the fuel burned by trade ships to transport goods adds a nontrivial amount of greenhouse gas (GHG) to the atmosphere . It has been estimated that around 3% of global CO2 emissions, 8% of global SOX emissions, and 15% of global NOX emissions come from the combustion of fuel in ships . The objective to lower GHG emissions has been laid out by the International Maritime Organization (IMO) such that emissions will be reduced by at least 40% by 2030 and 50-70% by 2050 with respect to the 2008 levels . Cleaner fuels such as bio-LNG, bio-methanol, and ng-ammonia are already being tested and adopted . However, fossil fuels are still widely used, and the proportion of global emissions maritime activity is accountable for continues to climb . The impact of carbon emissions in the atmosphere and ocean are already well documented. It is known that NOX emissions are a precursor to ozone (O3) and that SOX emissions have a detrimental effect on health . However, the effect of NOX on the open ocean is less readily available. Plankton are small aquatic organisms, all of which have little to no swimming ability and move with the ocean currents . One of the trophic modes of plankton is phytoplankton, composed of photosynthetic plants and bacteria, which contribute to about half of global primary production . This photosynthetic activity also has a great effect on carbon dioxide levels in the atmosphere. It has been estimated that around 40% of anthropogenic carbon dioxide dissolves into the ocean, and a single type of phytoplankton, diatom, is responsible for fixing a quarter of that carbon dioxide via photosynthesis each year . Phytoplankton are highly sensitive to changes in their environment, such as temperature, nutrient availability, pH, and even light intensity . Elevated concentrations of nitrate (NO3-) in bodies of water can cause increases in the amount of phytoplankton . Extreme cases of planktonic growth are called algal blooms. Algal blooms remove all the oxygen from the water, creating what are called hypoxic zones, which suffocate marine life and damage the ecosystem. The source of this nitrogen has been shown to be from fertilizer on many occasions . Whether or not the NOX emissions from ship exhaust have any effect on plankton levels in the open waters of the ocean has not yet been documented.</p>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>Nitrate concentrations and some plankton values were obtained from the World Ocean Database (WOD). The data set was selected through the WOD query selector and CSV files were made available for download. The files from WOD were formatted in the following manner: each set of observations were included under a list of metadata including CAST number (a unique identifier for that set of observations), latitude, longitude, year, month, day, and more. A Python script was written to parse through these CSV files and extract all the observations as well as the above metadata. Besides the metadata, also included with the nitrate data was a value for nitrate concentration, the unit for said concentration (being micro molality, or μmol/kg), the depth of said observed nitrate concentration, the units for the depth (m), the uncertainty for the depth, and the units for that uncertainty (m). In addition to the metadata, the plankton data included a plankton value, a unit for that plankton value (e.g.&nbsp;#/m3), a measurement type (taxon dry mass, taxon wet mass, displacement, etc.) a WOD plankton grouping code that that specifies taxon and trophic mode (e.g.&nbsp;200000 values are phytoplankton, 400000 are zooplankton, etc.), and the genus for the observed plankton. The output of the Python script was a combined CSV file containing both nitrate and plankton data. This CSV was imported to a local Postgres database before being split into separate tables and cleaned to remove erroneous values before being uploaded to an online Postgres database hosted by Railway using DuckDB. Shipping density data was downloaded from the World Bank Group. This data consisted of a high resolution TIFF image, with each pixel representing shipping activity over a 0.005 by 0.005 degree grid, which equates to around a 500m by 500m square near the equator. Due to the large number of pixels in this image, it was not feasible to extract every pixel value from this image. Instead, latitude and longitude coordinates were taken from the observations from the World Ocean Database containing nitrate and plankton levels, and a Python script was run to obtain the pixel value at each location. Due to limitations in satellite imaging, data for above 85° north and -85° south was not available. Phytoplankton concentration data was downloaded from NASA’s OceanColor database using a programmatic query to the OceanData API. Specifically, the request targeted Aqua MODIS Level 3 chlorophyll a (otherwise known as a-chlorophyll) data, monthly composite, at a 9 km resolution, spanning from July 2002 to March 2025. As chlorophyll a is the form of chlorophyll used in photosynthesis, chlorophyll a levels can be used as a proxy for phytoplankton health and abundance. The raw .nc files were processed using xarray and pandas in Python to extract spatially gridded chlorophyll a values along with the corresponding latitude, longitude, year, and month. For each time step, the grid was averaged at a 0.01 degrees resolution to reduce data size. Final data was saved to year-specific .csv files for easy integration into downstream analysis pipelines and uploaded to a PostgreSQL database for access by mapping and modeling workflows. The chlorophyll a data was cleaned to remove extreme outliers and negative values (which are physically implausible). Data north of 85° and south of -85° latitude is missing due to satellite orbital limits and coverage.</p>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="clustering" class="level2">
<h2 class="anchored" data-anchor-id="clustering">Clustering</h2>
<p>To identify regions of the ocean with similar environmental profiles, we performed unsupervised clustering using the K-means algorithm. This method grouped ocean observation points based on a combination of spatial and environmental variables: latitude, longitude, nitrate concentration, plankton abundance, chlorophyll levels, shipping density, and distance from the nearest coastline. Prior to clustering, chlorophyll values were averaged at a 0.01° grid resolution and merged with the nitrate and plankton data from the World Ocean Database. Shipping density values were extracted at each point location from a raster image provided by the World Bank Group. A shapefile of global coastlines was used to compute the Euclidean distance of each observation from land using a spatial index (STRtree). All datasets were merged into a single data frame and any missing values were filled with zeroes before clustering. To ensure comparability between variables with different scales and units, we applied z-score standardization to each feature. We used the elbow method to determine the optimal number of clusters, plotting the within-cluster sum of squares (inertia) across values of k from 2 to 15. The kneed package was used to automatically detect the inflection point of this curve. Based on the elbow method, we selected k=4 as the optimal number of clusters. We then trained a K-means model with four clusters and assigned each ocean observation to one of the clusters. The resulting clusters were visualized globally and separately using Cartopy, which revealed geographic groupings that reflect underlying environmental similarities. These cluster assignments were used in subsequent statistical analysis (e.g., chi-square tests, ANOVA) to examine how nitrate and phytoplankton levels vary across shipping intensities within similar ecological zones.</p>
</section>
<section id="chi-square" class="level2">
<h2 class="anchored" data-anchor-id="chi-square">Chi Square</h2>
<p>Before applying regression models, we first wanted to establish whether there was a statistically significant association between shipping density and nitrate levels. To do this, we performed a chi-square test of independence using data limited to the Atlantic Ocean, where sampling density was highest and regional patterns were most coherent. We began by categorizing each observation point into “Low,” “Average,” or “High” shipping density based on standard deviation cutoffs from the mean. A similar categorization was applied to nitrate concentrations using the same logic. This resulted in a contingency table showing the frequency of each nitrate level within each shipping category. We then conducted a chi-square test on the resulting 3×3 contingency table. This test allowed us to assess whether nitrate concentrations were independent of shipping density across the Atlantic sample. The chi-square statistic, p-value, and expected counts were recorded and used to evaluate whether observed patterns were likely due to chance. A significant result here served as preliminary evidence that shipping activity and nitrate levels are related, providing justification for a more detailed investigation using linear modeling.</p>
</section>
<section id="anova" class="level2">
<h2 class="anchored" data-anchor-id="anova">ANOVA</h2>
<p>To further explore how nitrate levels vary across different environmental zones, we conducted a one-way analysis of variance (ANOVA) using the cluster assignments generated from the K-means analysis. The goal was to determine whether the mean nitrate concentrations differed significantly between the four clusters identified in the Atlantic Ocean region. We first filtered the dataset to the Atlantic bounding box to maintain consistency with previous analyses. Observations with missing nitrate values or undefined cluster assignments were excluded. The remaining data were then grouped by cluster, and nitrate values were extracted for each group. Using the scipy.stats.f_oneway() function, we performed an ANOVA test comparing nitrate concentrations across the four clusters. This test allowed us to assess whether the differences in mean nitrate levels between the clusters were greater than would be expected by chance alone. The resulting F-statistic and p-value were used to evaluate statistical significance. This approach complements the chi-square analysis by treating nitrate as a continuous variable rather than a categorical one, enabling a more granular assessment of nitrate distribution patterns across distinct environmental zones.</p>
</section>
<section id="linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression">Linear Regression</h2>
<p>Following the chi-square and ANOVA analyses, we applied a linear regression model to assess the strength and nature of the relationship between shipping density and nitrate levels. While the chi-square test established a categorical association and the ANOVA revealed differences across clusters, regression allowed us to quantify the relationship between these two continuous variables. We focused this analysis on observations from the Atlantic Ocean, where data coverage was densest. To reduce skewness and address heteroscedasticity in the raw data, we applied a log transformation to both the nitrate concentration and shipping density variables. A small constant (+1) was added to each value prior to transformation to avoid taking the logarithm of zero. An ordinary least squares (OLS) regression was performed using log-transformed shipping density as the independent variable and log-transformed nitrate concentration as the dependent variable. We used the statsmodels package to fit the model and generate diagnostic statistics including the regression coefficient, R-squared value, and p-value. A scatterplot with the regression line was created to visually confirm the linear relationship and assess model fit. This regression helped verify that shipping density is a significant predictor of nitrate levels even after accounting for spatial variation, and provided insight into the direction and magnitude of that effect.</p>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<p>To assess whether regional patterns exist in ocean nitrate levels and human activity, we first applied K-means clustering to the dataset. Based on the Elbow Method (see Figure 1), we selected four clusters that best captured variance in shipping density, nitrate concentrations, and distance from shore. When mapped spatially (see Figure 2), these clusters aligned with recognizable oceanographic patterns: Cluster 1 concentrated along dense shipping lanes in the North Atlantic and Mediterranean, Cluster 3 near highly trafficked coasts, Cluster 2 in less-trafficked open ocean, and Cluster 0 spread broadly across lower-traffic southern regions.</p>
<div class="row">
<pre><code>&lt;div class="col-sm mt-3 mt-md-0"&gt;
    ![](elbow_plot.png){fig-cap="Figure 1" fig-alt="Elbow plot" class="img-fluid rounded z-depth-1"}
&lt;/div&gt;</code></pre>
</div>
<div class="row">
<pre><code>&lt;div class="col-sm mt-3 mt-md-0"&gt;
   ![](clustering_map.png){fig-cap="Figure 2" fig-alt="" class="img-fluid rounded z-depth-1"}
&lt;/div&gt;</code></pre>
</div>
<p>To test whether shipping density categories are independent of nitrate concentration, we used a chi-square test on the contingency table of shipping and nitrate categories. The result showed a highly significant association:</p>
<p><span class="math display">\[
\text{Chi-square Statistic}: 212.997  
p-\text{value}: 5.60 \times 10^{-47}
\text{Degrees of Freedom}: 2
\]</span></p>
<p>This means that areas with higher shipping density are significantly more likely to fall into higher nitrate categories, suggesting a non-random relationship between human maritime activity and nutrient levels in surrounding waters.</p>
<p>To directly measure the relationship between shipping activity and nitrate concentration, we ran a log-log regression using Atlantic Ocean data. Both nitrate values and shipping densities were log-transformed to reduce skew and better meet linearity assumptions. The results were statistically significant:</p>
<p><span class="math display">\[
log(\text{nitrate}) = 1.97 + 0.019 \times log(\text{shipping})  
R^2 = 0.078, p &lt; 0.001
\]</span></p>
<p>While this is statistically significant with a <span class="math inline">\(p\)</span>-value less than 0.05, the <span class="math inline">\(R^2\)</span> indicates that very little of the variability in nitrate concentration is caused by shipping. These effects are consistent and regions with higher shipping do tend to have higher levels of nitrate. In (Figure 3) we plot the regression model to find:</p>
<div class="row">
<pre><code>&lt;div class="col-sm mt-3 mt-md-0"&gt;
    ![](linear_model.png){fig-cap="Figure 3" fig-alt="" class="img-fluid rounded z-depth-1"}
&lt;/div&gt;</code></pre>
</div>
<p>To test whether nitrate levels differ meaningfully across the environmental clusters we identified, we used a one-way ANOVA. This method evaluates whether the mean nitrate concentration is equal across the four cluster groups. We restricted the analysis to points located in the Atlantic Ocean region and filtered for rows with valid nitrate and cluster values. This test yielded a very large <span class="math inline">\(F\)</span>-statistic (38344.40) and a <span class="math inline">\(p\)</span>-value effectively equal to zero, strongly indicating that average nitrate levels vary significantly across clusters:</p>
<p>ANOVA Results (nitrate_value <span class="math inline">\(\sim\)</span> cluster): <span class="math inline">\(F\)</span> statistic: 38344.3988 <span class="math inline">\(p\)</span>-value: 0.0000e+00</p>
<p>Cluster 0: 12,866 observations<br>
Cluster 1: 1,286 observations<br>
Cluster 2: 12,802 observations<br>
Cluster 3: 9,362 observations</p>
<p>These results confirm that the clustering process successfully captured distinct nitrate regions. The high between-group variance relative to within-group variance suggests the clusters represent some change caused by humans.</p>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>While much of the results above suggested statistical significance, it is hard to say with certainty whether these results are true, or if they are a product of the variables analyzed. The ocean is a complex system full of moving parts, and many additional variables that were not included have the potential to affect the results of our analysis. Ocean currents, global and local weather patterns, and the lack of uniformity in the chemical composition of the water can affect how and where the NOX emissions come into contact and dissolve into the oceans and also the level and type of plankton found. The human effect is also complex, and distilling such an effect down to shipping density and distance from the coastline may be a gross oversimplification. While international shipping accounts for a sizable amount of NOX emissions into the atmosphere, it is not the only source. One key limitation of this study is the mismatch between the temporal and spatial resolution of our datasets. Shipping density was derived from aggregated raster imagery, while nitrate measurements are point-based and vary by collection date and depth, which may obscure short-term or fine-scale effects. Additionally, regression results showed low explanatory power, indicating that other factors such as ocean currents, natural upwelling, or atmospheric deposition likely play major roles in nitrate variability. Finally, data gaps particularly in polar regions and in areas with sparse in-situ sampling limit the global generalizability of our findings.</p>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>In this study we provide evidence that international shipping activity is associated with elevated nitrate levels in the ocean, particularly along dense maritime routes. Our combinations of Clustering, chi-square, ANOVA, and linear regression analyses revealed that areas of high shipping density are significantly more likely to exhibit higher nitrate concentrations, though the overall effect size remains modest. These findings overall suggest that areas with higher shipping density contribute to the level of nitrate which may influence the surrounding ecosystem.</p>
<p>While statistically significant, the relationships identified here explain only a small fraction of nitrate variability, reflecting the complexity of ocean systems and the influence of natural processes such as currents and upwelling. The study highlights the need for more temporally and spatially resolved data to better quantify the impacts of maritime activity on nutrient levels and to connect nitrate enrichment directly to biological outcomes like phytoplankton blooms.</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<div id="refs" role="list">

</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
